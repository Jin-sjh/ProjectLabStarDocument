# 产品需求文档 (PRD) - Project LabStar (星研)

## 版本历史

| 版本号 | 日期 | 修改人 | 修改内容 | 状态 |
|--------|------|--------|----------|------|
| v2.3 | 2024-05-20 | Gemini (PM) | MVP 范围重大调整：优先 Space B (全库 RAG)，暂缓 Space C | 正式版 |
| v2.2 | 2024-05-20 | Gemini (PM) | 新增 MVP 规划章节，明确第一阶段交付范围 | 已归档 |
| v2.1 | 2024-05-20 | Gemini (PM) | 技术架构升级：后端引入 RAGFlow 以增强 PDF 解析能力 | 已归档 |
| v2.0 | 2024-05-20 | Gemini (PM) | 合并 PRD 与 UI/UX 设计方案，确立"三空间"架构 | 已归档 |
| v1.0 | 2024-05-20 | Gemini (PM) | 初始版本创建 | 已归档 |

---

## 1. 项目概览 (Project Overview)

### 1.1 背景与痛点 (Background & Problem)

当前高校科研团队（课题组）面临三大核心矛盾：

**1. 算力矛盾**

硕博生需要 GPT-4/Claude 3.5 等高质量模型辅助科研，但个人支付困难且难以报销；导师有经费，但缺乏合规的订阅报销渠道。

**2. 资产矛盾**

铁打的营盘流水的兵。学生毕业带走知识和经验，课题组缺乏"知识继承"；Zotero 仅作为存储工具，缺乏深度的语义关联和检索能力。

**3. 效率矛盾**

通用 AI 有幻觉且易忘事；学生写周报痛苦，导师看周报不仅无法验证真伪，也无法量化进度。

### 1.2 产品定位 (Product Positioning)

**LabStar (星研)：课题组的私有科研大脑与算力管家**

**商业本质：**

算力 SaaS 分发平台 + 团队知识沉淀工具

**核心口号：**

> "Open access to SOTA models, Close loop for lab knowledge."

### 1.3 核心差异化 (Unique Selling Points)

| 差异化特性 | 描述 |
|-----------|------|
| **算力 SaaS 化** | 导师充值、学生使用、合规报销 |
| **分层沉浸体验** | 区分"通用对话"、"知识库综述"、"单篇精读"三种场景 |
| **寄生策略** | 深度集成 Zotero，降低迁移成本 |
| **隐形周报** | 基于"灵感笔记"自动生成周报，将监控转化为协作 |

---

## 2. 用户画像 (User Personas)

| 用户角色 | 典型身份 | 核心诉求 | 产品价值 |
|----------|----------|----------|----------|
| 科研特种兵 | 硕博研究生、青椒 | 免费用 GPT-4、读文献不忘、周报好写 | 高效科研工具 + 免费算力福利 |
| 课题组长 (PI) | 博导、教授 | 经费合规使用、知识资产留存、掌握进度 | 团队管理抓手 + 知识库建设 |

---

## 3. 界面与交互设计 (UI/UX Design) - 核心体验

本产品采用 **"星际深空"** 设计语言，交互架构为 **"一枢纽 + 三空间 + 一通栏"**。

### 3.1 首页：星际枢纽 (The Star Hub)

**视觉风格：**

动态 3D 星空背景，每一颗星星代表一篇文献（颜色区分读过/未读）。

**核心组件：**

中央全能对话框 (Omni-Chat)

**模式切换器 (Mode Switcher)：**

输入框左侧胶囊按钮，选择对话对象：

1. 🟢 通用 AI (General AI) -> 进入空间 A
2. 🟣 我的星系 (My Universe) -> 进入空间 B
3. 🔵 单篇文献 (Specific Paper) -> 搜索/选择后进入空间 C

### 3.2 核心工作台：三大独立空间

#### A. 通用对话空间 (General AI Space)

**场景：**

润色邮件、编写代码、百科问答（不挂载知识库）

**布局：**

两栏式（中间对话流 + 右侧笔记栏）

**特点：**

极速响应，支持切换模型（Flash / Pro）

#### B. 全库研讨空间 (Knowledge Base Space)

**场景：**

课题组知识检索、跨文献综述、寻找研究灵感

**布局：**

三栏式

| 区域 | 宽度 | 功能描述 |
|------|------|----------|
| 左栏 | 20% | 局部星空图。高亮显示 AI 当前回答所参考的文献节点及其引用关系 |
| 中栏 | 50% | 对话流。回答内容必须包含引用脚标 [1] |
| 右栏 | 30% | 灵感笔记栏 |

#### C. 单篇精读空间 (Deep Reading Space)

**场景：**

深度阅读某篇 PDF，查参数，看图表

**布局：**

三栏式

| 区域 | 宽度 | 功能描述 |
|------|------|----------|
| 左栏 | 15% | PDF 目录大纲 / 缩略图 |
| 中栏 | 50% | 沉浸式 PDF 阅读器。支持划线高亮，划线后弹出菜单：📌 存入笔记 \| 💬 针对此句提问 |
| 右栏 | 35% | AI 助手 + 笔记（Tab 切换） |

**右栏 Tab 切换说明：**

- **Chat Tab：** 针对本文的问答（RAG 范围仅限本文）
- **Note Tab：** 本文的专属读书笔记

### 3.3 全局组件：灵感笔记栏 (The Insight Sidebar) - P0 级功能

**定义：**

贯穿所有界面的侧边抽屉，用于存放碎片化灵感

**核心特性：**

| 功能模块 | 描述 |
|---------|------|
| **卡片流 (Card Stream)** | 笔记以"卡片"形式堆叠，自动标记来源（如：From: GPT-4 / From: Nature Paper p.3） |
| **AI 润色引擎 (Refine Engine)** | 底部常驻按钮 ✨ Refine |
| **整理逻辑** | 重组散乱卡片 |
| **生成周报** | "基于本周笔记生成汇报" |
| **贡献知识** | "将笔记贡献至课题组公共库 (L2)" |

---

## 4. 功能需求详解 (Functional Requirements)

### 4.1 模块一：算力管家 (The Compute Wallet)

**优先级：** P0 (商业基石)

**核心功能：**

| 功能项 | 描述 |
|--------|------|
| **OpenRouter 聚合** | 后端对接 OpenRouter API，支持 GPT-4o, Claude 3.5, Gemini 1.5 Pro |
| **资金池管理** | 导师端充值（支持发票），设置全组 / 单人每月限额 |
| **模型路由** | 默认使用高性价比模型（如 Haiku / Flash），学生手动切换昂贵模型时提示倍率 |
| **熔断机制** | 异常高频调用自动暂停并报警 |

### 4.2 模块二：知识星空与 RAG (Knowledge Engine)

**优先级：** P0 (核心体验)

**核心功能：**

| 功能项 | 描述 |
|--------|------|
| **Zotero 同步** | 绑定 API Key，自动单向同步 PDF 及元数据 |
| **RAG 引擎 (Powered by RAGFlow)** | 采用 RAGFlow 的 DeepDoc 模块进行深度文档解析 |
| **核心解决** | 双栏论文排版识别、公式 / 表格数据提取、OCR 扫描件识别 |
| **自动 Embedding** | 解析后的 Chunk 自动向量化，使用 UMAP 算法生成星空坐标 |
| **混合检索** | 关键词检索 (Elasticsearch) + 向量检索 (Infinity / Milvus) + 引用关系检索 |

### 4.3 模块三：三层隐私架构 (Privacy & Data)

**优先级：** P0 (安全合规)

| 层级 | 名称 | 描述 |
|------|------|------|
| **L1** | 私有层 (Private) | 默认层。学生个人上传 / 同步的文献及笔记，物理隔离，导师不可见 |
| **L2** | 组内公开层 (Lab Public) | 导师上传的资料、学生主动"贡献"的笔记 / 文献。全组共享 |
| **L3** | 贡献机制 (Contribution) | 在周报生成或笔记整理时，引导学生将高价值笔记流转至 L2 |

### 4.4 模块四：记忆锚点 (Memory Anchor)

**优先级：** P0 (提升可用性)

| 功能 | 描述 |
|------|------|
| **Pin (设为公理)** | 用户在对话或原文中选中文字 -> 📌 Pin |
| **注入机制** | Pin 的内容加入 Global Context，作为 System Prompt 强制注入后续对话，解决长文本遗忘和幻觉问题 |

---

## 5. 技术架构 (Technical Architecture)

### 5.1 前端技术栈

| 技术 | 用途 |
|------|------|
| React | UI 框架 |
| Three.js | 星空渲染 |
| TailwindCSS | 样式框架 |

### 5.2 后端服务层 (Orchestrator)

**技术栈：** Python (FastAPI)

**职责范围：**

- 用户鉴权
- 计费扣费
- Zotero 同步调度
- 笔记管理

### 5.3 核心 RAG 引擎

**技术栈：** RAGFlow (Docker 部署)

**职责范围：**

- PDF 解析 (OCR / Layout)
- 分块 (Chunking)
- 检索 (Retrieval)
- 重排序 (Rerank)

### 5.4 数据库组件

| 数据库 | 用途 |
|--------|------|
| PostgreSQL | 用户、账单、笔记结构化数据 |
| Elasticsearch (via RAGFlow) | 倒排索引，用于精准关键词匹配 |
| Infinity / Milvus (via RAGFlow) | 向量数据库，存储 Embedding |
| S3 兼容存储 (MinIO / OSS) | 文件存储 |

### 5.5 LLM 接入

**OpenRouter API Proxy**

---

## 6. 运营与推广 (GTM Strategy)

### 6.1 种子轮

寻找 5 个能源 / 材料类课题组（文献多、图表多、经费足）内测

### 6.2 插件战术

开发 Zotero 插件 LabStar Sync，作为引流入口

### 6.3 定价策略 (建议)

| 费用类型 | 价格 | 包含内容 |
|----------|------|----------|
| SaaS 费 | ¥299 / 月 / 组 | 含基础功能 + 10GB 存储 |
| 算力费 | 预充值，按 Token 实扣 | 可加收 10% 服务费 |

---

## 7. 风险评估 (Risk Assessment)

| 风险点 | 影响 | 应对策略 |
|--------|------|----------|
| **OpenRouter 不稳定** | 服务中断 | 准备 Azure OpenAI / DeepSeek 直连作为备线 |
| **经费消耗过快** | 导师停用 | 默认开启上下文压缩；前端显著展示"本次对话预计消耗 ¥0.5" |
| **RAGFlow 资源占用** | 服务器成本高 | OCR 模型需要 GPU 推理。初期可关闭 DeepDoc 的 OCR 功能，仅用 Layout Analysis，或使用 Serverless GPU 部署解析服务 |
| **合规性风险** | 法律监管限制 | 限制在校内 / 课题组内网使用；严格内容审计；不涉及公网 To C 销售 |

---

## 8. MVP 产品范围 (MVP Scope)

**目标：** 在 4-5 周内上线，验证"全库 RAG 效果"与"导师付费意愿"

### 8.1 必须包含 (Must Have - P0)

| 功能模块 | 描述 |
|----------|------|
| **资金池系统** | 极简导师后台（邀请码、充值、额度） |
| **风控与合规** | 内置敏感词过滤，仅限邀请注册 |
| **Zotero 同步与 RAGFlow 集成** | 核心路径：输入 Zotero Key -> RAGFlow 后台自动拉取 PDF -> 解析入库 |
| **全库问答 (Space B)** | 这是 MVP 的绝对核心。支持针对整个 Zotero 文件夹进行提问（"总结一下关于钙钛矿稳定性的所有观点"） |

**核心界面 (Space B + Sidebar) 详细说明：**

| 区域 | 功能描述 |
|------|----------|
| **左侧** | 极简星空（Canvas 2D），展示文献聚类 |
| **中间** | 对话流。回答必须带引用来源（点击来源可打开 PDF 预览，但不需要做精读功能） |
| **右侧** | 灵感笔记栏 + 一键生成周报 |

### 8.2 暂不开发 (Out of Scope - Phase 2)

| 功能 | 说明 |
|------|------|
| **空间 C (单篇精读)** | MVP 阶段，点击引用来源仅打开浏览器原生的 PDF 预览，不做专门的划线、Pin、高亮交互 |
| **复杂的 L3 贡献流程** | 暂不支持自动流转 |
| **移动端适配** | 仅支持 PC 端 |

---

*文档版本：v2.3*
*最后更新：2024-05-20*
*维护者：Gemini (PM)*
