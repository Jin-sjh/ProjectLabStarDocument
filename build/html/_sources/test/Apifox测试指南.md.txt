# Apifox 测试指南

本指南介绍如何使用 Apifox 进行前后端API联调测试。

---

## 一、Apifox 简介

Apifox 是一款集 API 文档、API 调试、API Mock、API 自动化测试于一体的 API 协作平台。它可以帮助前后端开发者高效地进行接口联调。

### Apifox 的优势

1. **可视化界面**: 直观的界面，无需编写代码即可测试API
2. **环境管理**: 支持多环境配置（开发、测试、生产）
3. **参数自动填充**: 根据API文档自动生成请求参数
4. **响应格式化**: 自动格式化JSON响应，便于查看
5. **历史记录**: 保存请求历史，方便回溯
6. **团队协作**: 支持团队成员共享API接口

---

## 二、准备工作

### 2.1 安装 Apifox

1. 访问 Apifox 官网：https://apifox.com
2. 下载并安装对应操作系统的客户端
3. 注册/登录账号

### 2.2 启动后端服务

在项目根目录的 `backend` 文件夹下执行：

```bash
# 安装依赖
npm install

# 启动服务
npm start
```

服务启动后，会在 `http://localhost:3001` 运行。

---

## 三、在 Apifox 中创建项目

### 3.1 创建新项目

1. 打开 Apifox 客户端
2. 点击左侧的"新建项目"按钮
3. 输入项目名称，例如：`前后端联调Demo`
4. 选择项目类型：`HTTP API`
5. 点击"创建"

### 3.2 配置环境变量

1. 在项目设置中，选择"环境管理"
2. 添加环境变量：

| 环境名称 | 变量名 | 变量值 |
|----------|--------|--------|
| 开发环境 | baseUrl | http://localhost:3001/api |
| 测试环境 | baseUrl | http://test.example.com/api |
| 生产环境 | baseUrl | http://prod.example.com/api |

---

## 四、导入API接口

### 4.1 手动创建接口

#### 示例：创建"获取用户列表"接口

1. 在项目中点击"新建接口"
2. 填写接口信息：
   - **接口名称**: 获取用户列表
   - **请求方法**: GET
   - **接口路径**: `/users`
   - **接口描述**: 分页获取用户列表，支持关键词搜索

3. 配置请求参数（Query参数）：

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| page | number | 否 | 页码 | 1 |
| pageSize | number | 否 | 每页数量 | 10 |
| keyword | string | 否 | 搜索关键词 | 张 |

4. 配置响应示例（成功）：
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "张三",
      "email": "zhangsan@example.com",
      "age": 25
    }
  ],
  "pagination": {
    "page": 1,
    "pageSize": 10,
    "total": 1,
    "totalPages": 1
  }
}
```

5. 配置响应示例（失败）：
```json
{
  "success": false,
  "message": "服务器错误"
}
```

### 4.2 批量导入接口

如果已有 OpenAPI/Swagger 文档，可以直接导入：

1. 点击项目设置中的"导入数据"
2. 选择"OpenAPI"
3. 粘贴或上传 OpenAPI 文档内容
4. 点击"导入"

---

## 五、测试API接口

### 5.1 发送请求

1. 选择要测试的接口（例如：`GET /users`）
2. 点击"发送"按钮
3. 查看响应结果

### 5.2 查看响应

Apifox 会以格式化的方式显示响应内容：

- **响应状态**: 显示HTTP状态码（200、404、500等）
- **响应时间**: 显示请求耗时
- **响应大小**: 显示响应数据大小
- **响应体**: 格式化显示JSON数据

### 5.3 保存请求

1. 调整请求参数后
2. 点击"保存为示例"
3. 输入示例名称，例如：`获取第一页用户`
4. 保存后可以随时复用

---

## 六、常见接口测试场景

### 6.1 测试用户管理接口

#### 场景1：获取用户列表

**步骤**:
1. 选择 `GET /users` 接口
2. 点击"发送"
3. 查看返回的用户列表

**预期结果**:
```json
{
  "success": true,
  "data": [
    { "id": 1, "name": "张三", "email": "zhangsan@example.com", "age": 25 },
    { "id": 2, "name": "李四", "email": "lisi@example.com", "age": 30 },
    { "id": 3, "name": "王五", "email": "wangwu@example.com", "age": 28 }
  ],
  "pagination": { ... }
}
```

#### 场景2：创建新用户

**步骤**:
1. 选择 `POST /users` 接口
2. 在请求体中输入：
```json
{
  "name": "测试用户",
  "email": "test@example.com",
  "age": 25
}
```
3. 点击"发送"
4. 查看返回结果

**预期结果**:
```json
{
  "success": true,
  "message": "用户创建成功",
  "data": {
    "id": 4,
    "name": "测试用户",
    "email": "test@example.com",
    "age": 25
  }
}
```

#### 场景3：删除用户

**步骤**:
1. 选择 `DELETE /users/:id` 接口
2. 在路径参数中输入用户ID：`4`
3. 点击"发送"
4. 再次调用 `GET /users` 验证用户已被删除

### 6.2 测试订单创建接口

**步骤**:
1. 选择 `POST /orders` 接口
2. 在请求体中输入：
```json
{
  "userId": 1,
  "items": [
    { "productId": 2, "quantity": 2 },
    { "productId": 3, "quantity": 1 }
  ]
}
```
3. 点击"发送"
4. 查看返回的订单信息

**预期结果**:
```json
{
  "success": true,
  "message": "订单创建成功",
  "data": {
    "id": 1,
    "userId": 1,
    "userName": "张三",
    "items": [
      { "productId": 2, "productName": "无线鼠标", "price": 99, "quantity": 2, "subtotal": 198 },
      { "productId": 3, "productName": "机械键盘", "price": 299, "quantity": 1, "subtotal": 299 }
    ],
    "totalAmount": 497,
    "status": "pending",
    "createdAt": "2024-01-11T12:00:00.000Z"
  }
}
```

### 6.3 测试订单状态更新

**步骤**:
1. 选择 `PUT /orders/:id/status` 接口
2. 在路径参数中输入订单ID：`1`
3. 在请求体中输入：
```json
{
  "status": "paid"
}
```
4. 点击"发送"
5. 验证订单状态已更新

---

## 七、前后端协作流程

### 7.1 后端开发者工作流程

1. **定义接口**: 根据 API 文档设计接口
2. **实现接口**: 编写后端代码实现接口逻辑
3. **在Apifox中创建接口文档**: 添加接口说明、参数、响应示例
4. **自测**: 使用 Apifox 测试接口是否正常工作
5. **分享给前端**: 将 Apifox 项目链接分享给前端开发者

### 7.2 前端开发者工作流程

1. **查看API文档**: 在 Apifox 中查看接口文档
2. **测试接口**: 使用 Apifox 发送请求，了解接口行为
3. **编写前端代码**: 根据接口文档编写前端调用代码
4. **联调测试**: 前后端一起测试，确保数据交互正常
5. **反馈问题**: 如有问题，在 Apifox 中记录并反馈给后端

### 7.3 协作最佳实践

1. **接口先行**: 后端先定义接口文档，前端根据文档开发
2. **Mock数据**: 前端可以使用 Apifox 的 Mock 功能，不依赖后端即可开发
3. **版本控制**: 接口变更时及时更新文档，并通知前端
4. **接口测试用例**: 在 Apifox 中保存常用测试用例，方便回归测试
5. **环境切换**: 使用环境变量，快速切换开发/测试/生产环境

---

## 八、Apifox 高级功能

### 8.1 Mock 数据

前端开发者可以使用 Mock 功能模拟后端响应：

1. 在接口设置中，选择"Mock设置"
2. 设置 Mock 规则，例如：
```json
{
  "success": true,
  "data": [
    {
      "id": "@integer(1, 100)",
      "name": "@cname()",
      "email": "@email()",
      "age": "@integer(18, 60)"
    }
  ],
  "pagination": {
    "page": 1,
    "pageSize": 10,
    "total": "@integer(1, 100)",
    "totalPages": "@integer(1, 10)"
  }
}
```
3. 启用 Mock 服务，前端即可调用 Mock 接口

### 8.2 自动化测试

创建测试用例，自动化测试接口：

1. 在接口中添加"测试用例"
2. 编写断言脚本：
```javascript
// 断言响应状态码为200
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

// 断言success字段为true
pm.test("Response has success=true", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData.success).to.eql(true);
});
```
3. 运行测试用例，自动验证接口

### 8.3 接口集合

将相关接口组织成集合，批量测试：

1. 创建接口集合，例如：`用户管理接口集合`
2. 添加相关接口到集合
3. 点击"运行集合"，批量执行所有接口测试

---

## 九、常见问题

### Q1: Apifox 提示"连接失败"

**解决方案**:
1. 确认后端服务已启动
2. 检查环境变量 baseUrl 是否正确
3. 检查防火墙设置

### Q2: 接口返回 404 错误

**解决方案**:
1. 确认接口路径是否正确
2. 检查后端路由配置
3. 查看后端控制台日志

### Q3: 接口返回 500 错误

**解决方案**:
1. 查看后端控制台错误日志
2. 检查请求参数是否正确
3. 联系后端开发者排查问题

### Q4: 如何导出接口文档？

**解决方案**:
1. 点击项目设置
2. 选择"导出数据"
3. 选择导出格式（Markdown、HTML、OpenAPI等）
4. 点击"导出"

---

## 十、总结

使用 Apifox 进行前后端联调的优势：

1. **提高效率**: 可视化界面，快速测试接口
2. **减少沟通**: 统一的接口文档，减少误解
3. **便于协作**: 团队成员可以共享接口和测试用例
4. **保证质量**: 自动化测试，确保接口稳定性

通过本指南，前端和后端开发者可以高效地进行接口联调，加快项目开发进度。
